<template>
  <div class="detailart">
    <div class="article" v-if="article.title!=null&&article.title!=''">
      <div class="title" ref="title">
        {{article.title}}
      </div>
      <client-only class="cl">
        <mavon-editor
          class="md"
          :boxShadow="false"
          codeStyle="atelier-plateau-dark"
          :value="article.mdValue"
          :subfield = "false"
          defaultOpen = "preview"
          :toolbarsFlag = "false"
          :editable="false"
          :scrollStyle="true"
          :ishljs = "true"
        ></mavon-editor>
      </client-only>
      <div class="other_href" v-if="article.otherhref!=''">
        参考链接：
        <a :href="article.otherhref" target="_blank">{{article.otherhref}}</a>
      </div>
      <div class="article_tags">
              <el-tag v-for="tag in this.tagList" 
                :key="tag._id" 
                :type="tag.type"  
                size="small"
                effect="plain"
                disable-transitions>{{tag.tagName}}
              </el-tag>
      </div>
      <div class="article_other">
        posted @{{article.createTime|dateFormat}} 淡然 点赞数 ({{article.star>=10000?article.star/10000+'w':article.star>=1000?article.star/1000+'k':article.star}}) 
      </div>
      <div class="article_bottom">
        <div class="icons"  @click="clickLove">
          <svg t="1605170613017" v-show="!loved"   class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2904" width="20" height="20">
            <path d="M884.875894 359.14325301L646.970506 359.14325301c92.185562-340.464205-63.516616-357.853247-63.516616-357.853247-65.993017 0-52.312436 52.182476-57.3031 60.881602 0 166.502152-176.849824 296.971645-176.849824 296.971645l0 472.171899c0 46.607504 63.516616 63.393819 88.433098 63.393819l357.452111 0c33.641191 0 61.036122-88.224344 61.036122-88.224344 88.434122-300.70569 88.434122-390.177444 88.434122-390.177444C944.657442 354.17919501 884.875894 359.14325301 884.875894 359.14325301L884.875894 359.14325301 884.875894 359.14325301zM884.875894 359.14325301" p-id="2905"></path><path d="M251.671415 359.29981901L109.214912 359.29981901c-29.420053 0-29.873378 28.89612-29.873378 28.89612l29.420053 476.202703c0 30.309306 30.361495 30.309306 30.361495 30.309306L262.420223 894.70794801c25.686009 0 25.458835-20.049638 25.458835-20.049638L287.879058 395.41127101C287.879058 358.83728401 251.671415 359.29981901 251.671415 359.29981901L251.671415 359.29981901 251.671415 359.29981901zM251.671415 359.29981901" p-id="2906">
            </path>
          </svg>
          <svg t="1605170763452" v-show="loved" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3046" width="20" height="20">
            <path d="M884.875894 423.143253 646.970506 423.143253c92.185562-340.464205-63.516616-357.853247-63.516616-357.853247-65.993017 0-52.312436 52.182476-57.3031 60.881602 0 166.502152-176.849824 296.971645-176.849824 296.971645l0 472.171899c0 46.607504 63.516616 63.393819 88.433098 63.393819l357.452111 0c33.641191 0 61.036122-88.224344 61.036122-88.224344 88.434122-300.70569 88.434122-390.177444 88.434122-390.177444C944.657442 418.179195 884.875894 423.143253 884.875894 423.143253L884.875894 423.143253 884.875894 423.143253zM884.875894 423.143253" fill="#E73C12" p-id="3047"></path><path d="M251.671415 423.299819 109.214912 423.299819c-29.420053 0-29.873378 28.89612-29.873378 28.89612l29.420053 476.202703c0 30.309306 30.361495 30.309306 30.361495 30.309306L262.420223 958.707948c25.686009 0 25.458835-20.049638 25.458835-20.049638L287.879058 459.411271C287.879058 422.837284 251.671415 423.299819 251.671415 423.299819L251.671415 423.299819 251.671415 423.299819zM251.671415 423.299819" fill="#E73C12" p-id="3048">
            </path>
          </svg>
          <span>点赞</span>
        </div>
        <div class="icons" @click="$router.push({ name: 'reward'})">
          <svg t="1605171216802" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3837" width="20" height="20">
            <path d="M93.301869 185.490204h768.139973V847.578341H93.301869z" fill="#FFFFFF" p-id="3838"></path><path d="M743.581919 955.151678H211.562962c-65.290195 0-118.219503-52.932774-118.219503-118.227302V245.824261l354.675838 118.226435h59.106286L861.80662 245.823394v591.100982c0 65.293661-52.934507 118.228168-118.224701 118.228168zM508.569102 657.738302l85.795785-0.206217c21.487287 0.206217 29.142442-10.934698 29.537547-24.364793 0.331853-11.651258-10.67476-33.6047-30.057421-34.129773h-85.766326v-20.688413s65.099574-66.488506 81.994635-81.809213c16.840474-15.391756 21.097381-27.444185 10.68689-39.892584-10.550857-12.704004-29.152839-11.918127-42.772689-0.644645-13.821735 11.456305-80.305042 73.220017-80.305043 73.220017s-57.073576-58.939059-69.427531-70.796534c-11.094992-10.680825-34.646182-21.030664-47.31986-6.683856-13.223879 14.995785-2.943357 33.727737 5.33738 41.920962 8.257343 8.115244 79.678593 83.628775 79.678593 83.628774l-0.129968 22.72199H356.3238c-13.229078 0-24.916727 23.537326-24.496495 36.044645 0.424564 12.444067 10.445149 22.202981 24.467036 22.202981 14.014955 0 89.230424-0.519875 89.230424-0.519875l-0.194953 63.372724H352.630091c-13.229078 0-24.330135 13.322655-24.863873 25.829974-0.519875 12.51425 9.888883 29.467364 24.863873 29.467363H445.127061s-0.159428 21.681374 0.396838 30.712464c1.247699 20.168538 14.476777 28.421549 32.156848 28.751669 17.687003 0.337052 30.236778-14.46378 30.194322-27.698056-0.060652-10.937297-0.319723-31.766076-0.319723-31.766077s76.982177-0.1369 91.523938 0c14.541761 0.123037 25.413207-14.594615 24.821417-29.467363-0.519875-14.930801-9.558763-26.349848-31.630042-26.349848h-84.193705l0.491281-62.856316z m-1.442653-352.80429h-59.107152L93.345191 186.719708C93.345191 121.420848 146.272767 68.500205 211.564695 68.500205h532.018956c65.289329 0 118.225568 52.920643 118.225569 118.219503L507.126449 304.934012z" fill="#D81E06" p-id="3839">
            </path>
            </svg>
          <span>打赏</span>
        </div>
        <div class="icons" @click="$router.push({ name: 'chat'})">
          <svg t="1605171304267" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4619" width="20" height="20"><path d="M749.056 728.576h-40.96 16.384c13.824-1.024 24.576-12.288 24.576-26.112v26.112z m-591.872 0.512h40.96-16.384c-13.824-1.024-24.576-12.288-24.576-26.112v26.112z m591.872-369.152h-40.96 16.384c13.824 1.024 24.576 12.288 24.576 26.112v-26.112z m117.76-115.712h-40.96 16.384c13.824 1.024 24.576 12.288 24.576 26.112v-26.112zM157.184 360.448h40.96-16.384c-13.824 1.024-24.576 12.288-24.576 26.112v-26.112z m363.52 379.904c15.872 15.872 15.872 41.984 0 57.856l-111.616 111.616c-15.872 15.872-41.984 15.872-57.856 0s-15.872-41.984 0-57.856l111.616-111.616c16.384-15.872 41.984-15.872 57.856 0z m-165.888-196.096c0 22.528-18.432 40.96-40.96 40.96h-37.888c-22.528 0-40.96-18.432-40.96-40.96s18.432-40.96 40.96-40.96h37.888c22.528 0 40.96 18.432 40.96 40.96z m158.208 0c0 22.528-18.432 40.96-40.96 40.96h-37.888c-22.528 0-40.96-18.432-40.96-40.96s18.432-40.96 40.96-40.96h37.888c22.528 0 40.96 18.432 40.96 40.96z m158.208 0c0 22.528-18.432 40.96-40.96 40.96h-37.888c-22.528 0-40.96-18.432-40.96-40.96s18.432-40.96 40.96-40.96h37.888c22.528 0 40.96 18.432 40.96 40.96z" fill="#242424" p-id="4620"></path><path d="M707.584 810.496h54.784c37.376 0 68.096-30.72 68.096-68.096V346.112c0-37.376-29.696-67.584-67.072-68.096H139.264c-35.84 2.048-64 31.744-64 68.096v54.272h-0.512v287.744h0.512V742.4c0 34.304 25.088 62.464 57.856 67.584h160.768c22.528 0 40.96-18.432 40.96-40.96s-18.432-40.96-40.96-40.96H157.184V360.448h591.36v368.128H491.52c-22.528 0-40.96 18.432-40.96 40.96s18.432 40.96 40.96 40.96h216.064z" fill="#242424" p-id="4621"></path><path d="M886.784 162.816H314.368c-22.528 0-40.96 18.432-40.96 40.96s18.432 40.96 40.96 40.96h552.448v367.104c0 22.528 18.432 40.96 40.96 40.96s40.96-18.432 40.96-40.96v-384c-1.536-34.304-28.16-61.952-61.952-65.024z" fill="#FF1B1B" p-id="4622"></path></svg>
          <span>留言</span>
        </div>
        <a class="icons"  href="http://www.baidu.com" target="_blank">
          <svg t="1605171546899" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5451" width="20" height="20"><path d="M345.706 297.423c15.35 12.792 35.817 20.467 53.726 17.908 20.467 0 38.375-10.233 53.725-23.025 17.91-15.35 30.7-35.817 40.934-58.842C512 189.97 512 136.245 496.65 90.194c-10.234-30.7-28.142-58.842-53.726-76.75C427.574 3.21 404.548-1.906 384.081 0.652c-12.791 2.558-25.583 7.675-38.375 15.35-23.025 15.35-38.376 40.934-48.61 66.518-12.791 46.05-15.35 92.101-2.557 138.152 10.233 28.142 25.583 56.284 51.167 76.75z m255.837 2.558c17.909 15.35 40.934 25.584 63.96 25.584 20.466 2.558 38.375-2.558 56.283-12.792 17.909-10.233 33.26-25.584 43.493-43.492 12.792-20.467 23.025-40.934 30.7-63.96 5.117-17.908 7.675-38.375 5.117-58.842-2.559-28.142-15.35-53.726-33.259-76.751-12.792-15.35-28.142-30.7-46.05-38.376-12.792-5.116-28.143-10.233-40.935-7.675-17.908 2.559-33.258 12.792-46.05 23.026-17.909 15.35-33.259 33.258-43.493 53.725-10.233 17.909-20.466 38.376-23.025 61.401-2.558 25.584-2.558 51.168 2.559 74.193 5.116 23.025 12.791 46.05 30.7 63.96zM245.929 509.768c17.91-15.35 28.143-35.818 35.818-56.285 10.233-33.258 10.233-66.517 7.675-99.776 0-12.792-5.117-25.584-10.234-38.376-12.792-28.142-35.817-53.725-63.959-69.076-23.025-10.233-46.05-15.35-66.518-10.233-25.583 2.558-46.05 20.467-61.4 40.934-20.467 28.142-30.7 63.96-35.818 97.218-2.558 20.467 0 40.934 5.117 61.4 7.675 30.701 23.025 58.843 46.05 79.31 17.91 15.35 40.935 23.026 63.96 23.026 28.142 0 56.284-7.675 79.31-28.142z m736.811-76.752c-2.558-20.467-7.675-38.375-17.908-56.284-10.234-20.467-28.143-40.934-48.61-51.167-23.025-12.792-51.167-15.35-76.75-12.792-12.792 2.558-28.143 5.117-40.935 12.792-17.908 10.233-30.7 28.142-40.933 48.609-10.234 25.584-15.35 53.726-15.35 81.868 0 25.583 0 53.726 7.674 79.31 5.117 17.908 15.35 38.375 33.26 48.608 17.908 15.35 40.933 20.467 63.959 23.026 17.908 2.558 38.375 2.558 56.284-2.559 17.908-5.116 35.817-15.35 46.05-30.7 12.792-15.35 20.467-35.817 23.026-53.726 12.792-30.7 10.233-58.842 10.233-86.985zM911.106 819.33c-2.559-35.817-20.467-71.634-46.05-99.776-5.118-5.117-10.234-10.234-17.91-15.35-33.258-28.142-66.517-58.843-99.776-89.543-33.259-33.26-63.96-69.076-92.101-107.452-20.467-33.259-48.61-63.96-86.985-81.868-23.025-10.233-51.167-15.35-76.751-12.792-46.05 5.117-86.985 30.7-115.127 66.518-7.675 7.675-12.791 17.909-17.908 28.142-20.467 30.7-46.05 61.401-74.193 86.985-15.35 15.35-30.7 28.142-46.05 40.934-7.676 7.675-17.91 15.35-25.584 23.025-30.7 23.025-61.401 53.726-79.31 86.985-12.792 23.025-20.467 48.609-23.025 76.75 0 23.026 2.558 46.051 10.233 66.518 7.675 23.026 17.909 46.051 33.26 63.96 25.583 30.7 63.958 51.167 102.334 53.725 48.609 2.559 97.218 0 143.269-7.675 20.467-2.558 40.934-10.233 63.959-12.792 46.05-5.116 92.101-2.558 135.594 10.234 35.817 12.792 74.192 17.909 112.568 20.467 38.375 2.558 79.31-2.558 115.127-23.025 25.583-12.792 46.05-35.818 58.842-61.401 20.467-33.26 30.7-71.635 25.584-112.569zM481.3 924.224H363.615c-12.792 0-25.584 0-38.376-2.559-25.584-5.117-48.61-20.467-63.96-43.492-12.791-15.35-20.466-33.259-23.025-53.726a246.563 246.563 0 0 1 0-61.4c5.117-23.026 17.909-43.493 33.26-58.843 12.791-12.792 30.7-23.026 48.608-30.7 7.675-2.56 15.35-5.117 23.026-5.117h69.076v-97.219h66.517c2.559 120.244 2.559 237.929 2.559 353.056z m263.512 0H583.634c-17.908-2.559-33.258-7.676-46.05-17.909-15.35-12.792-23.026-33.259-23.026-51.167v-173.97h66.518v161.178c0 7.675 2.558 12.792 7.675 17.908 5.117 5.117 12.792 7.675 20.467 7.675h69.076V678.62h66.518v245.604z" fill="#306CFF" p-id="5452"></path><path d="M340.59 734.904c-12.793 5.117-25.585 15.35-33.26 30.7-5.116 12.792-7.675 25.584-7.675 38.376 0 15.35 5.117 30.7 12.792 43.492 10.234 15.35 28.142 25.584 46.05 23.026h53.727V732.346H353.38c-2.558-2.559-7.675 0-12.792 2.558z" fill="#306CFF" p-id="5453"></path></svg>
          <span>百度</span>
        </a>
      </div>
      
    </div>
    <div v-else>文章数据丢失</div>
    <Toast ref="toast"/>
  </div>
  
</template>

<script>
import {request} from '~/plugins/axios'
import 'mavon-editor/dist/markdown/github-markdown.min.css'
export default {
  layout:'defaults',
  head(){
    var list=[]
    for (let x of this.tagList){
      list.push(x.tagName)
    }
    return {
      title:this.article.title,
      meta:[
        {hid: 'keywords',name:"keywords",content:list.join(',')},
         { hid: 'description', name: 'description', content: this.article.contextText.slice(0,40) },
      ]
    }
  },
  data(){
    return{
      width:'0px',
      article:{},
      tagList:[],
      loved:false
    }
  },
  methods:{
    async clickLove(){
      if(this.loved==false){
        let res=await request({
          url:`/love`,
          method:'POST',
          data:{
            id:this.article._id
          }
        })
        if(res&&res.code==200){
          this.article.star+=1
          this.loved=true
          this.$refs.toast.shows('点赞成功,感谢您的认可~(๑′ᴗ‵๑)')
          var lovestr=localStorage.getItem('danranblog_lovelist')||''
          var lovelist=lovestr.split(',')
          lovelist.push(this.article._id)
          localStorage.setItem('danranblog_lovelist',lovelist.join(','))
        }
      }
    }
  },
  async asyncData({params,error,redirect}){
    console.log(params.id)
     let res=await request({
      url:`/detailarticle?id=${params.id}`
    })
    var article={}
    var tagList=[]
    console.log(res)
    if(res&&res.code==200){
        article=res.data.article
        tagList=res.data.tagList
    }
    else{
      redirect("/")
    }
    return {
        article,
        tagList
    }
  },
  mounted(){
    // this.width=this.$refs.title.offsetWidth+'px'
   
    var lovestr=localStorage.getItem('danranblog_lovelist')||''
    var id=this.article._id
    if(lovestr.indexOf(id)!=-1)
      this.loved=true
  }
}
</script>

<style scoped>
  .detailart{
     width: 100%;
  }
  .article{
    width: 100%;
    padding: 0 10px;
  }
  .article_content{
    width: 100%;
    height: 200px;
   
  }
  .other_href{
    font-size: 14px;
    color: #7f8c93;
    margin-top: 5px;
    margin-bottom: 10px;
    padding-left: 10px;
    word-break: break-all;
  }
  
  .article_other{
    margin-top: 5px;
    padding-left: 10px;
    font-size: 13px;
    color: #9eabb3;
  }
  .other_href a {
    color: #2fa7b7;
  }
  .other_href a:hover {
    color: #ff6600;
  }
  .el-tag{
    margin-right: 5px;
    opacity: 0.6;
  }
  .title{
    padding: 0 10px;
    padding-top: 10px;
    width: 100%;
    min-height: 100px;
    border-bottom: 1px dashed #9eabb3;
    text-align: center;
    font-size: 32px;
    color: #606975;
    text-shadow: 0 3px 6px rgba(0,0,0,0.3);
    text-overflow: -o-ellipsis-lastline;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    word-wrap:break-word;
    line-height: 34px;
  }
  .article_tags{
    padding-left: 10px;
  }
  .article_bottom{
    margin: 10px 0;
    margin-bottom: 20px;
    height: 80px;
    border-top: 1px dashed #c0c0c0;
    border-bottom: 1px dashed #c0c0c0;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .icons {
    margin: 0 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
  }
  .icons span {
    font-size: 12px;
    color: #7f8c93;
  }
  /* .md{
    max-width: 100%;
  } */
  @media screen and (max-width: 500px) {
    .title{
      font-size: 0.533333rem;
      min-height: 1.866667rem;
      line-height: 0.906667rem;
    }
    .icons{
      margin: 0 0.4rem;
    }
    .article_other{
        font-size: 0.346667rem;
    }
    .article_bottom {
      height: 60px;
    }
  }
  
</style>

